y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "orange2", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
test_xgb <-
function(input){
data <- input
set.seed(1989)
split <- initial_split(data,
prop = 0.8,
strata = labels_target)
train <- training(split)
test  <- testing(split)
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
}
test_xgb(BoW_data)
?lof
library(dbscan)
?lof
negative <-
BoW_data %>%
filter(labels_target = "0")
negative <-
BoW_data %>%
filter(labels_target == "0")
positive <-
BoW_data %>%
filter(labels_target == "1")
lof(negative)
lof(negative %>% select(-labels_target))
test123 <- data_frame(x = vector(),
y = vector())
test123 <- data_frame(x = TRUE,
y = FALSE)
test123$z <- TRUE
View(test123)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
boxplot(negative$lof_index)
boxplot(negative$lof_index, main = "negative")
boxplot(positive$lof_index, main = "positive")
rnorm(1000)
rnorm(1000) %>% quantile(0.99)
test123 <- rnorm(10000)
test123[test123 > quantile(test123, 0.99)]
test123[test123 > quantile(test123, 0.995)]
negative %>%
select(lof_index) %>%
density() %>%
plot(main = "negative")
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995)]
cbind(negative, positive)
lof_outlier <- cbind(negative, positive)
lof_cleaned_data <- cbind(negative, positive)
head(lof_cleaned_data)
head(lof_cleaned_data$labels_target)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
head(lof_cleaned_data$labels_target)
?head
head(lof_cleaned_data$labels_target, n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data$labels_target %>% head(n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data$labels_target %>% head(n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995)]
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
ncol(negative)
ncol(positive)
ncol(BoW_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
ncol(negative)
negative$lof_index <- lof(negative %>% select(-labels_target))
ncol(negative)
ncol(BoW_data)
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
ncol(negative)
ncol(negative)
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
ncol(negative)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995),]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995),]
ncol(negative)
ncol(positive)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
test_xgb(lof_cleaned_data)
0.917 - 0.798
#| include: false
library(tidyverse)
library(tidymodels)
library(tm)
library(dbscan)
library(isotree)
rm(list = ls())
#| include: false
data <- read.csv("data/2/data_rt.csv")
# And shuffle it, since the first half of the dataset is just negative reviews, and the second half is just positive.
data <- data[sample(nrow(data)), ]
#| echo: false
corpus <- Corpus(VectorSource(data$reviews))
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, stripWhitespace)
BoW_data <- DocumentTermMatrix(corpus)
BoW_data <- BoW_data %>% as.matrix() %>% as_tibble()
BoW_data <- cbind(BoW_data, data$labels)
colnames(BoW_data)[colnames(BoW_data) == "data$labels"] <- "labels_target"
BoW_data$labels_target <-
BoW_data$labels_target %>%
as.factor()
#| include: false
set.seed(1989)
split <- initial_split(BoW_data,
prop = 0.8,
strata = labels_target)
BoW_data <- training(split)
test  <- testing(split)
test_xgb <-
function(training_data){
train = training_data
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
}
test_xgb(BoW_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index < quantile(negative$lof_index, 0.995),]
positive <- positive[positive$lof_index < quantile(positive$lof_index, 0.995),]
#| include: false
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data <-
lof_cleaned_data %>%
select(-lof_index)
test_xgb(lof_cleaned_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
model <- isolation.forest(negative %>% select(-labels_target))
negative$iso_index <- predict(model, negative %>% select(-labels_target)) %>%
as.numeric()
negative %>%
select(iso_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
model <- isolation.forest(positive %>% select(-labels_target))
positive$iso_index <- predict(model, positive %>% select(-labels_target)) %>%
as.numeric()
positive %>%
select(iso_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$iso_index < quantile(negative$iso_index, 0.995),]
positive <- positive[positive$iso_index < quantile(positive$iso_index, 0.995),]
#| include: false
negative$labels_target <- 0
positive$labels_target <- 1
iso_cleaned_data <- rbind(negative, positive)
iso_cleaned_data <- iso_cleaned_data[sample(nrow(iso_cleaned_data)), ]
iso_cleaned_data$labels_target <- iso_cleaned_data$labels_target %>%
as.factor()
iso_cleaned_data <-
iso_cleaned_data %>%
select(-iso_index)
test_xgb(iso_cleaned_data)
#| include: false
library(tidyverse)
library(tidymodels)
library(tm)
library(dbscan)
library(isotree)
rm(list = ls())
#| include: false
data <- read.csv("data/2/data_rt.csv")
# And shuffle it, since the first half of the dataset is just negative reviews, and the second half is just positive.
data <- data[sample(nrow(data)), ]
#| echo: false
corpus <- Corpus(VectorSource(data$reviews))
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, stripWhitespace)
BoW_data <- DocumentTermMatrix(corpus)
BoW_data <- BoW_data %>% as.matrix() %>% as_tibble()
BoW_data <- cbind(BoW_data, data$labels)
colnames(BoW_data)[colnames(BoW_data) == "data$labels"] <- "labels_target"
BoW_data$labels_target <-
BoW_data$labels_target %>%
as.factor()
#| include: false
set.seed(1989)
split <- initial_split(BoW_data,
prop = 0.8,
strata = labels_target)
BoW_data <- training(split)
test  <- testing(split)
test_xgb <-
function(training_data){
train = training_data
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
}
test_xgb(BoW_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index < quantile(negative$lof_index, 0.95),]
positive <- positive[positive$lof_index < quantile(positive$lof_index, 0.95),]
#| include: false
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data <-
lof_cleaned_data %>%
select(-lof_index)
test_xgb(lof_cleaned_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
model <- isolation.forest(negative %>% select(-labels_target))
negative$iso_index <- predict(model, negative %>% select(-labels_target)) %>%
as.numeric()
negative %>%
select(iso_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
model <- isolation.forest(positive %>% select(-labels_target))
positive$iso_index <- predict(model, positive %>% select(-labels_target)) %>%
as.numeric()
positive %>%
select(iso_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$iso_index < quantile(negative$iso_index, 0.95),]
positive <- positive[positive$iso_index < quantile(positive$iso_index, 0.95),]
#| include: false
negative$labels_target <- 0
positive$labels_target <- 1
iso_cleaned_data <- rbind(negative, positive)
iso_cleaned_data <- iso_cleaned_data[sample(nrow(iso_cleaned_data)), ]
iso_cleaned_data$labels_target <- iso_cleaned_data$labels_target %>%
as.factor()
iso_cleaned_data <-
iso_cleaned_data %>%
select(-iso_index)
test_xgb(iso_cleaned_data)
