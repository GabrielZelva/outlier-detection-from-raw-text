rf_model <- rand_forest(trees = 500, mtry = 2) %>%
set_mode("classification") %>%
set_engine("ranger")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(rf_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test)
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
metrics(results, truth = labels_target, estimate = .pred_class)
rec <- recipe(labels_target ~ ., data = train)
rf_model <- rand_forest(trees = 500, mtry = 2) %>%
set_mode("classification") %>%
set_engine("ranger")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(rf_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_positive_class)
rec <- recipe(labels_target ~ ., data = train)
rf_model <- rand_forest(trees = 500, mtry = 2) %>%
set_mode("classification") %>%
set_engine("ranger")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(rf_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_1)
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "blue", size = 1.2) +
geom_abline(lty = 2, color = "gray") +   # diagonal reference
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate")
roc_auc(results, truth = labels_target, .pred_positive_class)
rec <- recipe(labels_target ~ ., data = train)
rf_model <- rand_forest(trees = 500, mtry = 2) %>%
set_mode("classification") %>%
set_engine("ranger")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(rf_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_1)
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "blue", size = 1.2) +
geom_abline(lty = 2, color = "gray") +   # diagonal reference
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate")
roc_auc(results, truth = labels_target, .pred_1)
rec <- recipe(labels_target ~ ., data = train)
rf_model <- rand_forest(trees = 500, mtry = 2) %>%
set_mode("classification") %>%
set_engine("ranger")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(rf_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "blue", size = 1.2) +
geom_abline(lty = 2, color = "gray") +   # diagonal reference
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate")
roc_auc(results, truth = labels_target, .pred_0)
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
install.packages("xgboost")
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "blue", size = 1.2) +
geom_abline(lty = 2, color = "gray") +   # diagonal reference
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate")
roc_auc(results, truth = labels_target, .pred_0)
roc_auc(results, truth = labels_target, .pred_0)[".estimate"]
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
theme_bw()
roc_auc(results, truth = labels_target, .pred_0)[".estimate"]
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
theme_bw()
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"]
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
annotate("text", x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3)), size = 5) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1)
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
annotate("text", x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3)), size = 5) +
theme_bw()
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
annotate("text", x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3)), size = 5) +
theme_bw()
auc
?annotate
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
ggplot2::annotate("text", x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3)), size = 5) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
ggplot2::annotate("text", x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3)), size = 5, color = "white") +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
geom_label(
aes(x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3))),
fill = "white",       # background color
color = "black",      # text color
size = 5,
label.size = 0.5      # border thickness
) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
geom_label(
aes(x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3))),
fill = "white",       # background color
color = "black",      # text color
size = 5,
label.size = 0.5      # border thickness
) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
geom_label(
aes(x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3))),
fill = "white",       # background color
color = "black",      # text color
size = 5,
label.size = 0.5      # border thickness
) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
xlim(0, 1) + ylim(0, 1) +
geom_label(
aes(x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3))),
size = 3) +
theme_bw()
ggplot(roc_res, aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve", x = "False Positive Rate", y = "True Positive Rate") +
coord_cartesian(xlim = c(0, 1), ylim = c(0, 1)) +
geom_label(
aes(x = 0.75, y = 0.1, label = paste0("AUC = ", round(auc, 3))),
size = 3) +
theme_bw()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "cyan3", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "orange2", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_line(color = "orange2", size = 1.2) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
test_xgb <-
function(input){
data <- input
set.seed(1989)
split <- initial_split(data,
prop = 0.8,
strata = labels_target)
train <- training(split)
test  <- testing(split)
rec <- recipe(labels_target ~ ., data = train)
xgb_model <- boost_tree(
trees = 500,
tree_depth = 6,
learn_rate = 0.1,
loss_reduction = 0,
sample_size = 1) %>%
set_mode("classification") %>%
set_engine("xgboost")
wf <-
workflow() %>%
add_recipe(rec) %>%
add_model(xgb_model)
fit <- fit(wf, data = train)
pred <- predict(fit, test, type = "prob")
results <- test %>%
select(labels_target) %>%
bind_cols(pred)
roc_res <- roc_curve(results, truth = labels_target, .pred_0)
auc <- roc_auc(results, truth = labels_target, .pred_0)[".estimate"] %>% pull()
ggplot(roc_res,
aes(x = 1 - specificity, y = sensitivity)) +
geom_ribbon(aes(ymin = 0, ymax = sensitivity), fill = "cyan3", alpha = 0.3) +
geom_line(color = "orange2") +
geom_abline(lty = 2, color = "gray") +
labs(title = "ROC Curve",
x = "False Positive Rate",
y = "True Positive Rate") +
geom_label(aes(x = 0.85, y = 0.1,
label = paste0("AUC = ", round(auc, 3))),
size = 4) +
theme_bw()
}
test_xgb(BoW_data)
?lof
library(dbscan)
?lof
negative <-
BoW_data %>%
filter(labels_target = "0")
negative <-
BoW_data %>%
filter(labels_target == "0")
positive <-
BoW_data %>%
filter(labels_target == "1")
lof(negative)
lof(negative %>% select(-labels_target))
test123 <- data_frame(x = vector(),
y = vector())
test123 <- data_frame(x = TRUE,
y = FALSE)
test123$z <- TRUE
View(test123)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
boxplot(negative$lof_index)
boxplot(negative$lof_index, main = "negative")
boxplot(positive$lof_index, main = "positive")
rnorm(1000)
rnorm(1000) %>% quantile(0.99)
test123 <- rnorm(10000)
test123[test123 > quantile(test123, 0.99)]
test123[test123 > quantile(test123, 0.995)]
negative %>%
select(lof_index) %>%
density() %>%
plot(main = "negative")
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995)]
cbind(negative, positive)
lof_outlier <- cbind(negative, positive)
lof_cleaned_data <- cbind(negative, positive)
head(lof_cleaned_data)
head(lof_cleaned_data$labels_target)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
head(lof_cleaned_data$labels_target)
?head
head(lof_cleaned_data$labels_target, n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data$labels_target %>% head(n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- cbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
lof_cleaned_data$labels_target %>% head(n = 10)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995)]
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
ncol(negative)
ncol(positive)
ncol(BoW_data)
negative <-
BoW_data %>%
filter(labels_target == "0")
ncol(negative)
negative$lof_index <- lof(negative %>% select(-labels_target))
ncol(negative)
ncol(BoW_data)
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
ncol(negative)
ncol(negative)
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995)]
ncol(negative)
negative <-
BoW_data %>%
filter(labels_target == "0")
negative$lof_index <- lof(negative %>% select(-labels_target))
negative %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "negative")
positive <-
BoW_data %>%
filter(labels_target == "1")
positive$lof_index <- lof(positive %>% select(-labels_target))
positive %>%
select(lof_index) %>%
pull() %>%
density() %>%
plot(main = "positive")
negative <- negative[negative$lof_index > quantile(negative$lof_index, 0.995),]
positive <- positive[positive$lof_index > quantile(positive$lof_index, 0.995),]
ncol(negative)
ncol(positive)
negative$labels_target <- 0
positive$labels_target <- 1
lof_cleaned_data <- rbind(negative, positive)
lof_cleaned_data <- lof_cleaned_data[sample(nrow(lof_cleaned_data)), ]
lof_cleaned_data$labels_target <- lof_cleaned_data$labels_target %>%
as.factor()
test_xgb(lof_cleaned_data)
0.917 - 0.798
